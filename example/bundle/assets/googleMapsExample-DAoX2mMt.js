import{W as A,S as F,a as G,O as v,n as s}from"./three.module-CrM3Sdgj.js";import{G as T,e as S}from"./GLTFLoader-DesqJ6ah.js";import{D as M}from"./DRACOLoader-D_9vCzO5.js";import{g as W,C as P,t as b}from"./lil-gui.module.min-C0dNwVk_.js";import{S as L}from"./stats.module--VATS4Kh.js";import{C as z}from"./CameraTransitionManager-DdHYHpwr.js";import{W as g,G as $,T as H}from"./TileCompressionPlugin-BK8XeyyJ.js";import{G as I,U as O}from"./UpdateOnChangePlugin-Bfl0CQbI.js";import{T as K}from"./TilesFadePlugin--RsjXkIU.js";import{G as U}from"./GoogleCloudAuthPlugin-Df8JamBV.js";import"./TilesRenderer-DD_LqKmh.js";import"./B3DMLoader-aPf5svSz.js";import"./readMagicBytes-Da5ueiou.js";import"./LoaderBase-CVSPpjX2.js";import"./PNTSLoader-BKmvYx0Z.js";import"./I3DMLoader-uk6OaXCg.js";import"./CMPTLoader-C0F-2Ze2.js";import"./GLTFExtensionLoader-Cf5SHTW2.js";import"./EnvironmentControls-CC2KExwZ.js";let m,u,d,e,r,w,C;const k=localStorage.getItem("googleApiKey")??"put-your-api-key-here",c={orthographic:!1,enableCacheDisplay:!1,enableRendererStats:!1,apiKey:k,reload:y};j();E();function y(){e&&(u.remove(e.group),e.dispose(),e=null),localStorage.setItem("googleApiKey",c.apiKey),e=new $,e.registerPlugin(new U({apiToken:c.apiKey})),e.registerPlugin(new H),e.registerPlugin(new O),e.registerPlugin(new K),e.group.rotation.x=-Math.PI/2,e.errorTarget=50;const o=new M;o.setDecoderPath("https://unpkg.com/three@0.153.0/examples/jsm/libs/draco/gltf/");const t=new T(e.manager);t.setDRACOLoader(o),e.manager.addHandler(/\.gltf$/,t),u.add(e.group),e.setResolutionFromRenderer(r.camera,d),e.setCamera(r.camera),m.setTilesRenderer(e)}function j(){d=new A({antialias:!0}),d.setClearColor(1383455),document.body.appendChild(d.domElement),u=new F,r=new z(new G(60,window.innerWidth/window.innerHeight,1,16e7),new v(-1,1,1,-1,1,16e7)),r.perspectiveCamera.position.set(48e5,257e4,1472e4),r.perspectiveCamera.lookAt(0,0,0),r.addEventListener("camera-changed",({camera:n,prevCamera:l})=>{e.deleteCamera(l),e.setCamera(n),m.setCamera(n)}),r.orthographicPositionalZoom=!1,m=new I(u,r.camera,d.domElement,null),m.enableDamping=!0,y(),R(),window.addEventListener("resize",R,!1),window.addEventListener("hashchange",D);const o=new W;o.width=300,o.add(c,"orthographic").onChange(n=>{m.getPivotPoint(r.fixedPoint),m.updateCameraClipPlanes(r.perspectiveCamera),m.updateCameraClipPlanes(r.orthographicCamera),r.toggle()});const t=o.addFolder("Google Tiles");t.add(c,"apiKey"),t.add(c,"reload");const a=o.addFolder("Example Options");a.add(c,"enableCacheDisplay"),a.add(c,"enableRendererStats"),w=document.createElement("div"),document.getElementById("info").appendChild(w),C=new L,C.showPanel(0),document.body.appendChild(C.dom),D(),setInterval(B,100)}function R(){const{perspectiveCamera:o,orthographicCamera:t}=r,a=window.innerWidth/window.innerHeight;o.aspect=a,o.updateProjectionMatrix(),t.left=-t.top*a,t.right=-t.left,t.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight),d.setPixelRatio(window.devicePixelRatio)}function B(){if(!e)return;const o=r.camera,t={},a={},n=e.group.matrixWorld.clone().invert(),l=o.position.clone().applyMatrix4(n),p=o.matrixWorld.clone().premultiply(n);g.getPositionToCartographic(l,t),g.getAzElRollFromRotationMatrix(t.lat,t.lon,p,a,P),a.azimuth*=s.RAD2DEG,a.elevation*=s.RAD2DEG,t.lat*=s.RAD2DEG,t.lon*=s.RAD2DEG;const i=new URLSearchParams;i.set("lat",t.lat.toFixed(4)),i.set("lon",t.lon.toFixed(4)),i.set("height",t.height.toFixed(2)),i.set("az",a.azimuth.toFixed(2)),i.set("el",a.elevation.toFixed(2)),window.history.replaceState(void 0,void 0,`#${i}`)}function D(){const o=window.location.hash.replace(/^#/,""),t=new URLSearchParams(o);if(!t.has("lat")&&!t.has("lon"))return;e.group.updateMatrixWorld();const a=r.camera,n=parseFloat(t.get("lat")),l=parseFloat(t.get("lon")),p=parseFloat(t.get("height"))||1e3;if(t.has("az")&&t.has("el")){const i=parseFloat(t.get("az")),h=parseFloat(t.get("el"));g.getRotationMatrixFromAzElRoll(n*s.DEG2RAD,l*s.DEG2RAD,i*s.DEG2RAD,h*s.DEG2RAD,0,a.matrixWorld,P),a.matrixWorld.premultiply(e.group.matrixWorld),a.matrixWorld.decompose(a.position,a.quaternion,a.scale),g.getCartographicToPosition(n*s.DEG2RAD,l*s.DEG2RAD,p,a.position),a.position.applyMatrix4(e.group.matrixWorld)}else g.getCartographicToPosition(n*s.DEG2RAD,l*s.DEG2RAD,p,a.position),a.position.applyMatrix4(e.group.matrixWorld),a.lookAt(0,0,0)}function E(){if(requestAnimationFrame(E),!e)return;m.enabled=!r.animating,m.update(),r.update();const o=r.camera;e.setResolutionFromRenderer(o,d),e.setCamera(o),o.updateMatrixWorld(),e.update(),d.render(u,o),C.update(),q()}function q(){const o=e.lruCache.itemList.length/e.lruCache.maxSize;let t="";if(c.enableCacheDisplay){t+=`Downloading: ${e.stats.downloading} Parsing: ${e.stats.parsing} Visible: ${e.visibleTiles.size}<br/>`;const p=new Set;e.traverse(h=>{const f=h.cached.scene;f&&f.traverse(x=>{x.geometry&&p.add(x.geometry)})});let i=0;p.forEach(h=>{i+=S(h)}),t+=`Cache: ${(100*o).toFixed(2)}% ~${(i/1e3/1e3).toFixed(2)}mb<br/>`}if(c.enableRendererStats){const p=d.info.memory,i=d.info.programs.length;t+=`Geometries: ${p.geometries} Textures: ${p.textures} Programs: ${i}`}w.innerHTML!==t&&(w.innerHTML=t);const a=e.group.matrixWorld.clone().invert(),n=r.camera.position.clone().applyMatrix4(a),l={};g.getPositionToCartographic(n,l),document.getElementById("credits").innerText=b(l.lat,l.lon)+`
`+e.getCreditsString()}
