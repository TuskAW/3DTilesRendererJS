import{p as R,ag as U,k as B,af as A,n as T}from"./three.module-CrM3Sdgj.js";import{W as C,a as P,L as S,b as N,T as L}from"./TilesRenderer-DD_LqKmh.js";import{E as M}from"./lil-gui.module.min-C0dNwVk_.js";const w=new M(C,C,P),F=new M(S,S,N);class G{constructor(){this.creditsCount={}}_adjustCredits(t,n){const o=this.creditsCount,e=t.split(/;/g);for(let a=0,m=e.length;a<m;a++){const l=e[a];l in o||(o[l]=0),o[l]+=n?1:-1,o[l]<=0&&delete o[l]}}addCredits(t){this._adjustCredits(t,!0)}removeCredits(t){this._adjustCredits(t,!1)}toString(){return Object.entries(this.creditsCount).sort((n,o)=>{const e=n[1];return o[1]-e}).map(n=>n[0]).join("; ")}}const j="https://tile.googleapis.com",V=`${j}/v1/3dtiles/root.json`,_=new R,b=new U,z=s=>class extends s{constructor(t,n=w){super(t),this.ellipsoid=n}setLatLonToYUp(t,n){const{ellipsoid:o,group:e}=this;b.set(Math.PI/2,Math.PI/2,0),_.makeRotationFromEuler(b),o.getEastNorthUpFrame(t,n,e.matrix).multiply(_).invert().decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0)}},W=s=>class extends z(s){constructor(t=V){super(t,w),this._credits=new G,this.fetchOptions.mode="cors",this.parseQueue.maxJobs=10,this.downloadQueue.maxJobs=30,this.lruCache.minSize=3e3,this.lruCache.maxSize=5e3,this.errorTarget=40,this.addEventListener("tile-visibility-change",n=>{const{tile:o,visible:e}=n,a=o.cached.metadata.asset.copyright||"";e?this._credits.addCredits(a):this._credits.removeCredits(a)})}getCreditsString(){return this._credits.toString()}},J=W(L),Q=z(L),E=new B;function v(s,t){if(s.isInterleavedBufferAttribute||s.array instanceof t)return s;const o=t===Int8Array||t===Int16Array||t===Int32Array?-1:0,e=new t(s.count*s.itemSize),a=new A(e,s.itemSize,!0),m=s.itemSize,l=s.count;for(let p=0;p<l;p++)for(let c=0;c<m;c++){const f=T.clamp(s.getComponent(p,c),o,1);a.setComponent(p,c,f)}return a}function k(s,t=Int16Array){const n=s.geometry,o=n.attributes,e=o.position;if(e.isInterleavedBufferAttribute||e.array instanceof t)return e;const a=new t(e.count*e.itemSize),m=new A(a,e.itemSize,!1),l=e.itemSize,p=e.count;n.computeBoundingBox();const c=n.boundingBox,{min:f,max:h}=c,u=2**(8*t.BYTES_PER_ELEMENT-1)-1,d=-u;for(let i=0;i<p;i++)for(let r=0;r<l;r++){const g=r===0?"x":r===1?"y":"z",x=f[g],y=h[g],I=T.mapLinear(e.getComponent(i,r),x,y,d,u);m.setComponent(i,r,I)}c.getCenter(E),s.position.add(E),s.scale.x*=.5*(h.x-f.x)/u,s.scale.y*=.5*(h.y-f.y)/u,s.scale.z*=.5*(h.z-f.z)/u,o.position=m,s.geometry.boundingBox=null,s.geometry.boundingSphere=null,s.updateMatrixWorld()}class Y{constructor(t){this._options={generateNormals:!1,disableMipmaps:!0,compressIndex:!0,compressNormals:!0,compressUvs:!0,compressPosition:!1,uvType:Int8Array,normalType:Int8Array,positionType:Int16Array,...t}}processTileModel(t,n){const{generateNormals:o,disableMipmaps:e,compressIndex:a,compressUvs:m,compressNormals:l,compressPosition:p,uvType:c,normalType:f,positionType:h}=this._options;t.traverse(u=>{if(u.material&&e){const d=u.material;for(const i in d){const r=d[i];r&&r.isTexture&&(r.generateMipmaps=!1)}}if(u.geometry){const d=u.geometry,i=d.attributes;if(m){const{uv:r,uv1:g,uv2:x,uv3:y}=i;r&&(i.uv=v(r,c)),g&&(i.uv1=v(g,c)),x&&(i.uv2=v(x,c)),y&&(i.uv3=v(y,c))}if(o&&!i.normals&&d.computeVertexNormals(),l&&i.normals&&(i.normals=v(i.normals,f)),p&&k(u,h),a&&d.index){const r=i.position.count,g=d.index,x=r>65535?Uint32Array:r>255?Uint16Array:Uint8Array;if(!(g.array instanceof x)){const y=new x(d.index.count);y.set(g.array);const I=new A(y,1);d.setIndex(I)}}}})}}export{Q as E,J as G,F as L,Y as T,w as W};
